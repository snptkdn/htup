# htup 仕様書 (Specification)

## 1. コンセプト & 哲学
**「実行はTUIで、編集はエディタで」**

`htup` は、スピードとキーボード操作を重視する開発者のための TUI ベースの HTTP クライアントです。
複雑な JSON ボディやヘッダーの編集を無理に TUI で行うのは効率が悪いという認識に基づいています。
そのため、複雑な編集はユーザーが使い慣れたテキストエディタ (Vim, VS Code, Nano 等) に委任し、TUI は以下に特化します：
- プロジェクトとリクエスト間の高速なナビゲーション
- 即時のリクエスト実行
- レスポンスの可視化

## 2. コア機能

### 2.1 プロジェクト & リクエスト管理
- **ファイルシステムベース**: プロジェクトはディレクトリ、リクエストはその中のファイルとして管理します。
- **Git フレンドリー**:全てのリクエストデータは人間が読めるプレーンテキスト形式（推奨: RFC 2616 スタイル または `.http` 形式）で保存され、リポジトリ内でのバージョン管理が容易です。

### 2.2 「エディタファースト」ワークフロー
- **リクエストの作成**:
    1. TUI で「新規リクエスト (New Request)」を選択。
    2. テンプレートを選択 (例: "GET JSON", "POST Form", "GraphQL")。
    3. `htup` がファイルを作成し、即座に `$EDITOR` で開く。
    4. ユーザーがメソッド、URL、ヘッダー、ボディを編集し、保存して終了。
    5. `htup` がファイルをリロードし、リストに新しいリクエストを表示。
- **リクエストの編集**:
    1. リクエストを選択。
    2. `e` キー（設定可能）を押すと、ファイルが `$EDITOR` で開く。
    3. 保存して閉じると、`htup` にフォーカスが戻る。

### 2.3 実行 & レスポンス
- **高速実行**: 専用のキーバインド（`Enter` または `r`）でリクエストを即時送信。
- **レスポンスビューア**:
    - ステータスコード、所要時間、サイズのサマリー表示。
    - 整形されたボディ表示（JSON/XML ハイライト）。
    - ボディとヘッダーの表示切り替え。
    - 生のレスポンスボディを外部エディタ/ページャー (`p`) で開き、詳細な検査や検索を行う機能。

## 3. データ保存形式 (提案)
標準的な **.http** (IntelliJ/VS Code Rest Client) 形式、またはその単純化されたスーパーセットの使用を提案します。

**例: `api/create_user.http`**
```http
POST https://api.example.com/users
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "username": "htup_user",
    "role": "admin"
}
```

**メリット**:
- ほぼすべてのエディタでシンタックスハイライトが標準サポートされている。
- 標準準拠で学習コストが低い。
- パース（解析）が容易。

## 4. ユーザーインターフェース (レイアウト案)
```
+------------------+------------------------------------------------+
| [Projects]       | [Request Details]                              |
| > My API         | Method: POST                                   |
|   - get_users    | URL: https://api.example.com/users             |
|   - create_user  |                                                |
|   - health_check | [Headers]                                      |
|                  | Content-Type: application/json                 |
| [History]        |                                                |
| < 200 OK 120ms   | [Body Preview]                                 |
| < 404 .. 40ms    | {                                              |
|                  |   "username": "htup_user",                     |
|                  |   "role": "admin"                              |
|                  | }                                              |
|                  |                                                |
+------------------+------------------------------------------------+
| [Status Bar]                                                      |
| <Enter>: Run | <e>: Edit | <n>: New | <q>: Quit                   |
+-------------------------------------------------------------------+
```

## 5. 技術スタック
- **言語**: Rust
- **TUI フレームワーク**: `ratatui` (堅牢な Rust TUI の標準)
- **HTTP クライアント**: `reqwest`
- **エディタ連携**: `std::process::Command` で `$EDITOR` を子プロセスとして起動。

## 6. 決定事項 (Decisions)
1. **データ形式 (Data Format)**:
   - **`.http` 形式**を採用します。標準的であり、既存のエディタとの互換性が高いためです。
2. **環境変数 (Environment Variables)**:
   - プロジェクトごとに `.env` ファイルを使用します。
   - `htup` 上からもこの `.env` ファイルを編集できるようにします。
3. **エディタ連携 (Editor Integration)**:
   - 当面は CLI エディタ (Vim/Nano) や GUI エディタ (VS Code) をコマンドで呼び出す方式とします。
   - **将来的な拡張**: ローカルホストのブラウザをエディタとして使用する構想があるため、エディタ呼び出し部分は抽象化し、将来的にコマンド以外（URLオープン等）もサポートできるように設計します。
